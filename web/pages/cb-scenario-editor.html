<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cursed Blades</title>
</head>
<body>

<script type="module">

    import {
        CBScenarioEditorGame, CBEditorPlayer
    } from "../jslib/cblades/editor.js";
    import {
        CBMap
    } from "../jslib/cblades/map.js";
    import {
        CBWing
    } from "../jslib/cblades/unit.js";
    import {
        GoblinBanner1
    } from "../jslib/cblades/armies/orcs.js";
    import {
        RoughneckBanner1
    } from "../jslib/cblades/armies/roughnecks.js";
    import {
        GameLoader
    } from "../jslib/cblades/loader.js";

    function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    let game = new CBScenarioEditorGame("scenario");
    let map = new CBMap([]);
    game.setMap(map);
    new GameLoader(game, (name, path)=>new CBEditorPlayer(name, path)).load(getParameterByName("id"),
        ()=>{
            let player1 = new CBEditorPlayer("orc-1", "./../images/units/players/orc-1.png");
            game.addPlayer(player1);
            let wing1 = new CBWing(player1, GoblinBanner1);
            wing1.setRetreatZone(map.getSouthZone());
            let player2 = new CBEditorPlayer("roughneck-1", "./../images/units/players/roughneck-1.png");
            game.addPlayer(player2);
            let wing2 = new CBWing(player2, RoughneckBanner1);
            wing2.setRetreatZone(map.getNorthZone());

            game.fitWindow();
            document.body.appendChild(game.root);
            game.setMenu();
        }
    );

    /*
    let game = new CBScenarioEditorGame("scenario");

    let map = new CBMap([
        {path:"./../images/maps/map-1.png", icon:"./../images/maps/map-1-icon.png", col:0, row:0, invert:true},
        {path:"./../images/maps/map-4.png", icon:"./../images/maps/map-4-icon.png", col:1, row:0}
    ]);
    game.setMap(map);
    game.fitWindow();
    document.body.appendChild(game.root);
    game.setMenu();

    let player1 = new CBEditorPlayer("orc-1", "./../images/units/players/orc-1.png");
    game.addPlayer(player1);
    let wing1 = new CBWing(player1, GoblinBanner1);
    wing1.setRetreatZone(map.getSouthZone());
    let player2 = new CBEditorPlayer("roughneck-1", "./../images/units/players/roughneck-1.png");
    game.addPlayer(player2);
    let wing2 = new CBWing(player2, RoughneckBanner1);
    wing2.setRetreatZone(map.getNorthZone());

    game.start();
*/
</script>
</body>
</html>